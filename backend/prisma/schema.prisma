generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["omitApi"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// model Category {
//   id        Int       @id @default(autoincrement())
//   name      String    @unique @db.VarChar(60)
//   createdAt DateTime  @default(now()) @map("created_at")
//   updatedAt DateTime  @updatedAt @map("updated_at") //to dziala tak ze prisma to aktualizuje automatycznie przy kazdej zmianie rekordu
//   products  Product[] //relacja miedzy kategoria a produktem

//   @@map("categories") // to dziala tak ze zmienia nazwe tabeli w bazie danych na "categories" zamiast domyslnej "Category"
// }

// model Product {
//   id          Int      @id @default(autoincrement())
//   name        String   @db.VarChar(120)
//   description String?  @db.Text //? oznacza ze pole jest opcjonalne 
//   price       Decimal  @db.Decimal(10, 2)
//   currency    String   @default("USD") @db.Char(3)
//   quantity    Int      @default(0)
//   active      Boolean  @default(true)
//   createdAt   DateTime @default(now()) @map("created_at")
//   updatedAt   DateTime @updatedAt @map("updated_at") //to dziala tak ze prisma to aktualizuje automatycznie przy kazdej zmianie rekordu
//   categoryId  Int      @map("category_id")
//   category    Category @relation(fields: [categoryId], references: [id]) //relacja miedzy produktem a kategoria

//   @@map("products")
// }

model User {
  id                  Int                 @id @default(autoincrement())
  email               String              @unique @db.VarChar(120)
  name                String              @unique @db.VarChar(120)
  passwordHashed      String              @db.VarChar(255)
  phoneNumber         String              @db.VarChar(9)
  createdAt           DateTime            @default(now()) @map("created_at")
  offers              Offer[]
  messages            Message[]
  sellerConversations ChatConversation[]  @relation("SellerConversations")
  buyerConversations  ChatConversation[]  @relation("BuyerConversations")
  likes               Like[]
  pricePropostions    PricePropostion[]
  meetingPropostions  MeetingPropostion[]

  @@map("users")
}

model Offer {
  id                  Int                 @id @default(autoincrement())
  ownerId             Int                 @map("owner_id")
  user                User                @relation(fields: [ownerId], references: [id])
  brand               String              @db.VarChar(120)
  model               String              @db.VarChar(120)
  version             String              @db.VarChar(120)
  Cartype             String              @default("Samochody osobowe") @db.VarChar(60)
  year                Int
  location            String              @db.VarChar(120)
  mileage             Int
  price               Decimal             @db.Decimal(10, 2)
  fuelType            String              @map("fuel_type") @db.VarChar(60)
  engineCapacity      Int                 @map("engine_capacity")
  power               Int
  doors               Int
  color               String              @db.VarChar(60)
  interiorColor       String              @map("interior_color") @db.VarChar(60)
  torque              Int
  bodyType            String              @map("body_type") @db.VarChar(60)
  seats               Int
  vin                 String              @db.VarChar(17)
  transmission        String              @db.VarChar(60)
  description         String              @db.Text
  equipment           String[]
  warranty            String              @db.Text
  isNoAccident        Boolean             @default(true) @map("is_no_accident")
  offerType           String              @default("Standardowe") @db.Text
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at") //to dziala tak ze prisma to aktualizuje automatycznie przy kazdej zmianie rekordu
  views               Int                 @default(0)
  likes               Int                 @default(0)
  messageCount        Int                 @default(0) @map("message_count")
  carServiceHistories CarServiceHistory[]
  chatConversations   ChatConversation[]
  likedBy             Like[]

  @@map("offers")
}

model CarServiceHistory {
  id      Int   @id @default(autoincrement())
  offerId Int   @map("offer_id")
  offer   Offer @relation(fields: [offerId], references: [id])

  data      String   @db.Text
  mileage   Int
  type      String   @db.VarChar(60)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("car_service_histories")
}

model ChatConversation {
  id                 Int                 @id @default(autoincrement())
  offerId            Int                 @map("offer_id")
  offer              Offer               @relation(fields: [offerId], references: [id])
  sellerId           Int                 @map("seller_id")
  seller             User                @relation("SellerConversations", fields: [sellerId], references: [id])
  buyerId            Int                 @map("buyer_id")
  buyer              User                @relation("BuyerConversations", fields: [buyerId], references: [id])
  createdAt          DateTime            @default(now()) @map("created_at")
  messages           Message[]
  pricePropostions   PricePropostion[]
  meetingPropostions MeetingPropostion[]

  @@map("chat_conversations")
}

model Message {
  id                 Int              @id @default(autoincrement())
  chatConversationId Int              @map("chat_conversation_id")
  chatConversation   ChatConversation @relation(fields: [chatConversationId], references: [id])
  senderId           Int              @map("sender_id")
  sender             User             @relation(fields: [senderId], references: [id])
  createdAt          DateTime         @default(now()) @map("created_at")
  isRead             Boolean          @default(false) @map("is_read")
  content            String           @db.Text

  @@map("messages")
}

model PricePropostion {
  id                 Int              @id @default(autoincrement())
  chatConversationId Int              @map("chat_conversation_id")
  chatConversation   ChatConversation @relation(fields: [chatConversationId], references: [id])
  senderId           Int              @map("sender_id")
  sender             User             @relation(fields: [senderId], references: [id])
  createdAt          DateTime         @default(now()) @map("created_at")
  isRead             Boolean          @default(false) @map("is_read")
  price              Decimal          @db.Decimal(10, 2)
  status             String           @default("Oczekuje na odpowiedź") @db.VarChar(60)
}

model MeetingPropostion {
  id                 Int              @id @default(autoincrement())
  chatConversationId Int              @map("chat_conversation_id")
  chatConversation   ChatConversation @relation(fields: [chatConversationId], references: [id])
  senderId           Int              @map("sender_id")
  sender             User             @relation(fields: [senderId], references: [id])
  createdAt          DateTime         @default(now()) @map("created_at")
  isRead             Boolean          @default(false) @map("is_read")
  meetingDate        DateTime         @map("meeting_date")
  meetingTime        String           @map("meeting_time") @db.VarChar(10)
  location           String           @db.VarChar(255)
  status             String           @default("Oczekuje na odpowiedź") @db.VarChar(60)
}

model Like {
  id      Int   @id @default(autoincrement())
  userId  Int   @map("user_id")
  user    User  @relation(fields: [userId], references: [id])
  offerId Int   @map("offer_id")
  offer   Offer @relation(fields: [offerId], references: [id])

  @@map("likes")
}
